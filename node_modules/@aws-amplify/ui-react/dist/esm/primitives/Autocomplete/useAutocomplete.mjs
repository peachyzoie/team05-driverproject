import*as e from"react";import{isFunction as t}from"@aws-amplify/ui";import{ARROW_UP as o,ARROW_DOWN as n,ENTER_KEY as l,ESCAPE_KEY as s}from"../shared/constants.mjs";import{strHasLength as i}from"../shared/utils.mjs";import{useStableId as a}from"../utils/useStableId.mjs";const c=new Set([n,o,l,s]),u=({defaultValue:u="",value:r,options:d,optionFilter:m,onBlur:f,onChange:p,onClear:h,onClick:g,onSelect:b,onSubmit:C})=>{const I=void 0!==r,[v,k]=e.useState(u),w=I?r:v,[O,B]=e.useState(!1),[E,y]=e.useState(null),S=t(m),T=e.useMemo((()=>{const e=S?e=>m(e,w):e=>{const{label:t}=e;return null==t?void 0:t.toLocaleLowerCase().includes(null==w?void 0:w.toLocaleLowerCase())};return(null==d?void 0:d.filter(e))||[]}),[w,m,S,d]),H=a(),L=a(),M=a(),V=a(),j=T.findIndex((e=>e===E)),x=(null==E?void 0:E.id)||(-1!==j?`${V}-option-${j}`:void 0),D=e.useCallback((e=>{B(!1),y(null),t(f)&&f(e)}),[f]),F=e.useCallback((e=>{y(null),B(!0),I||k(e.target.value),t(p)&&p(e)}),[I,p]),R=e.useCallback((()=>{I||k(""),t(h)&&h()}),[I,h]),$=e.useCallback((e=>{B(!0),t(g)&&g(e)}),[g]);return e.useEffect((()=>{const e=document.getElementById(H),t=document.getElementById(M);if(t&&O&&e){const{bottom:o}=t.getBoundingClientRect(),{offsetParent:n,offsetTop:l}=e;n===document.body&&o>document.documentElement.clientHeight&&window.scrollTo({top:Math.min(o-document.documentElement.clientHeight+window.scrollY+20,l),behavior:"smooth"})}}),[H,O,M]),e.useEffect((()=>{const e=document.getElementById(L),t=i(x)?document.getElementById(x):null;if(t&&e){const{scrollTop:o,clientHeight:n}=e,{offsetHeight:l,offsetTop:s}=t,{top:i,bottom:a}=t.getBoundingClientRect();o>s&&(e.scrollTop=s),o+n<s+l&&(e.scrollTop=s+l-n),(i<0||a>document.documentElement.clientHeight)&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[x,L]),{activeOptionId:x,autocompleteId:H,composedValue:w,filteredOptions:T,handleOnBlur:D,handleOnClear:R,handleOnClick:$,handleOnChange:F,handleOnKeyDown:e=>{const{key:i}=e;if(c.has(i))switch(e.preventDefault(),i){case s:O?(B(!1),y(null)):R();break;case l:if(E){const{label:e}=E;I||k(e),t(b)&&b(E)}else t(C)&&C(w);B(!1),y(null);break;case n:{if(T.length<=0)return;B(!0);const e=j>=T.length-1?0:j+1;y(T[e]);break}case o:{if(T.length<=0)return;B(!0);const e=j<=0?T.length-1:j-1;y(T[e])}}},isControlled:I,isCustomFiltering:S,isMenuOpen:O,listboxId:L,menuId:M,optionBaseId:V,setActiveOption:y,setIsMenuOpen:B,setInternalValue:k}};export{u as useAutocomplete};
